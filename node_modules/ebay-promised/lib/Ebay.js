"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

// dynamic definitions aggregated from crawling Ebay"s API docs


var _Request = require("./Request");

var _Request2 = _interopRequireDefault(_Request);

var _errors = require("./errors");

var _Immutable = require("./utils/Immutable");

var _Immutable2 = _interopRequireDefault(_Immutable);

var _endpoints = require("./definitions/endpoints");

var _endpoints2 = _interopRequireDefault(_endpoints);

var _fields = require("./definitions/fields");

var _fields2 = _interopRequireDefault(_fields);

var _globals = require("./definitions/globals");

var _globals2 = _interopRequireDefault(_globals);

var _verbs = require("./definitions/verbs");

var _verbs2 = _interopRequireDefault(_verbs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Ebay = function () {
  _createClass(Ebay, null, [{
    key: "create",

    /**
     * pure creation interface useful for iterations and other places where context may be lost
     *
     * @return     {this}  a new Ebay instance
     */
    value: function create(settings) {
      return new Ebay(settings);
    }

    /**
     * Loads credentials from `process.env`
     * 
     * @return {this}          a new Ebay instance
     * @throws {Env_Error}
     */

  }, {
    key: "fromEnv",
    value: function fromEnv() {
      return Ebay.create({
        authToken: process.env.EBAY_TOKEN || _errors.throws.Env_Error("EBAY_TOKEN"),
        cert: process.env.EBAY_CERT || _errors.throws.Env_Error("EBAY_CERT"),
        app: process.env.EBAY_APP_ID || _errors.throws.Env_Error("EBAY_APP_ID"),
        devName: process.env.EBAY_DEV_ID || _errors.throws.Env_Error("EBAY_DEV_ID"),
        sandbox: process.env.EBAY_SANDBOX || false
      });
    }

    /**
     * 
     *
     * @param      {Object}  settings the global settings
     * @return     {Ebay}
     */

  }]);

  function Ebay(settings) {
    _classCallCheck(this, Ebay);

    /**
     * global settings for all following Ebay requests
     */
    this.globals = _Immutable2.default.merge(Ebay.defaults, settings);
    /**
     * insure an error is thrown if internals are changed
     * allows for better assertions about the statefulness 
     */
    Object.freeze(this.globals);
  }

  /**
   * Deprecated in favor of `Ebay.prototype.run`
   * adds to developer ergonomics by adding a sensible error
   * 
   * @deprecated
   * @throws     {Error}
   * @return      null
   */


  _createClass(Ebay, [{
    key: "invoke",
    value: function invoke() {
      console.warn("deprecation warning :: the .invoke() method has been migrated to .run() and will be removed in the next major release");
      return this.run();
    }

    /**
     * developer ergonomic error that ensures we have at least defined the verb we want to attempt
     * 
     * @throws {Error} 
     * @return null
     */

  }, {
    key: "run",
    value: function run() {
      _errors.throws.Error("Cannot run an empty Request, please define an eBay verb or field");
    }
  }]);

  return Ebay;
}();

/**
 * defaults for eBay API
 */


exports.default = Ebay;
Ebay.defaults = {
  serviceName: "Trading",
  sandbox: false,
  site: 0,
  raw: false // return raw XML -> JSON response from Ebay
  , perPage: 100
};

/**
 * reference to the {Request} class
 */
Ebay.Request = _Request2.default;

_verbs2.default.forEach(function (verb) {
  Ebay[verb] = function () {
    return Ebay.create()[verb]();
  };

  Ebay.prototype[verb] = function () {
    return Ebay.Request.create(this)[verb]();
  };
});

Object.keys(_endpoints2.default).forEach(function (endpoint) {
  Ebay[endpoint] = function () {
    return Ebay.create()[endpoint]();
  };

  Ebay.prototype[endpoint] = function () {
    return Ebay.serviceName(endpoint);
  };
});

_fields2.default.forEach(function (field) {
  Ebay[field] = function (val) {
    return Ebay.create()[field](val);
  };

  Ebay.prototype[field] = function (val) {
    return Ebay.Request.create(this)[field](val);
  };
});

_globals2.default.forEach(function (global) {
  Ebay[global] = function (val) {
    return Ebay.create()[global](val);
  };

  Ebay.prototype[global] = function (val) {
    var cloned = _Immutable2.default.merge(this.globals, _defineProperty({}, global, val));
    return Ebay.create(cloned);
  };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9FYmF5LmpzIl0sIm5hbWVzIjpbIkViYXkiLCJzZXR0aW5ncyIsImNyZWF0ZSIsImF1dGhUb2tlbiIsInByb2Nlc3MiLCJlbnYiLCJFQkFZX1RPS0VOIiwiRW52X0Vycm9yIiwiY2VydCIsIkVCQVlfQ0VSVCIsImFwcCIsIkVCQVlfQVBQX0lEIiwiZGV2TmFtZSIsIkVCQVlfREVWX0lEIiwic2FuZGJveCIsIkVCQVlfU0FOREJPWCIsImdsb2JhbHMiLCJtZXJnZSIsImRlZmF1bHRzIiwiT2JqZWN0IiwiZnJlZXplIiwiY29uc29sZSIsIndhcm4iLCJydW4iLCJFcnJvciIsInNlcnZpY2VOYW1lIiwic2l0ZSIsInJhdyIsInBlclBhZ2UiLCJSZXF1ZXN0IiwiZm9yRWFjaCIsInZlcmIiLCJwcm90b3R5cGUiLCJrZXlzIiwiZW5kcG9pbnQiLCJmaWVsZCIsInZhbCIsImdsb2JhbCIsImNsb25lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFJQTs7O0FBSkE7Ozs7QUFDQTs7QUFDQTs7OztBQUdBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7Ozs7O0lBRXFCQSxJOzs7O0FBQ25COzs7OzsyQkFLZ0JDLFEsRUFBVztBQUN6QixhQUFPLElBQUlELElBQUosQ0FBVUMsUUFBVixDQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7Ozs4QkFNa0I7QUFDaEIsYUFBT0QsS0FBS0UsTUFBTCxDQUFZO0FBQ2ZDLG1CQUFZQyxRQUFRQyxHQUFSLENBQVlDLFVBQVosSUFBNEIsZUFBT0MsU0FBUCxDQUFpQixZQUFqQixDQUR6QjtBQUVmQyxjQUFZSixRQUFRQyxHQUFSLENBQVlJLFNBQVosSUFBNEIsZUFBT0YsU0FBUCxDQUFpQixXQUFqQixDQUZ6QjtBQUdmRyxhQUFZTixRQUFRQyxHQUFSLENBQVlNLFdBQVosSUFBNEIsZUFBT0osU0FBUCxDQUFpQixhQUFqQixDQUh6QjtBQUlmSyxpQkFBWVIsUUFBUUMsR0FBUixDQUFZUSxXQUFaLElBQTRCLGVBQU9OLFNBQVAsQ0FBaUIsYUFBakIsQ0FKekI7QUFLZk8saUJBQVlWLFFBQVFDLEdBQVIsQ0FBWVUsWUFBWixJQUE0QjtBQUx6QixPQUFaLENBQVA7QUFPRDs7QUFFRDs7Ozs7Ozs7O0FBTUEsZ0JBQWNkLFFBQWQsRUFBeUI7QUFBQTs7QUFDdkI7OztBQUdBLFNBQUtlLE9BQUwsR0FBZ0Isb0JBQVVDLEtBQVYsQ0FBZ0JqQixLQUFLa0IsUUFBckIsRUFBK0JqQixRQUEvQixDQUFoQjtBQUNBOzs7O0FBSUFrQixXQUFPQyxNQUFQLENBQWMsS0FBS0osT0FBbkI7QUFDRDs7QUFFRDs7Ozs7Ozs7Ozs7OzZCQVFVO0FBQ1BLLGNBQVFDLElBQVIsQ0FBYSx1SEFBYjtBQUNELGFBQU8sS0FBS0MsR0FBTCxFQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7OzswQkFNTztBQUNMLHFCQUFPQyxLQUFQLENBQWEsa0VBQWI7QUFDRDs7Ozs7O0FBR0g7Ozs7O2tCQXBFcUJ4QixJO0FBdUVyQkEsS0FBS2tCLFFBQUwsR0FBZ0I7QUFDWk8sZUFBZSxTQURIO0FBRVpYLFdBQWUsS0FGSDtBQUdaWSxRQUFlLENBSEg7QUFJWkMsT0FBZSxLQUpILENBSWM7QUFKZCxJQUtaQyxTQUFlO0FBTEgsQ0FBaEI7O0FBUUE7OztBQUdBNUIsS0FBSzZCLE9BQUw7O0FBRUEsZ0JBQU1DLE9BQU4sQ0FBZSxnQkFBUTtBQUNyQjlCLE9BQUsrQixJQUFMLElBQWEsWUFBWTtBQUN2QixXQUFPL0IsS0FBS0UsTUFBTCxHQUFjNkIsSUFBZCxHQUFQO0FBQ0QsR0FGRDs7QUFJQS9CLE9BQUtnQyxTQUFMLENBQWVELElBQWYsSUFBdUIsWUFBWTtBQUNqQyxXQUFPL0IsS0FBSzZCLE9BQUwsQ0FBYTNCLE1BQWIsQ0FBcUIsSUFBckIsRUFBNEI2QixJQUE1QixHQUFQO0FBQ0QsR0FGRDtBQUdELENBUkQ7O0FBVUFaLE9BQU9jLElBQVAsc0JBQXVCSCxPQUF2QixDQUFnQyxvQkFBWTtBQUMxQzlCLE9BQUtrQyxRQUFMLElBQWlCLFlBQVk7QUFDM0IsV0FBT2xDLEtBQUtFLE1BQUwsR0FBY2dDLFFBQWQsR0FBUDtBQUNELEdBRkQ7O0FBSUFsQyxPQUFLZ0MsU0FBTCxDQUFlRSxRQUFmLElBQTJCLFlBQVk7QUFDdEMsV0FBT2xDLEtBQUt5QixXQUFMLENBQWtCUyxRQUFsQixDQUFQO0FBQ0EsR0FGRDtBQUlELENBVEQ7O0FBV0EsaUJBQU9KLE9BQVAsQ0FBZ0IsaUJBQVM7QUFDdkI5QixPQUFLbUMsS0FBTCxJQUFjLFVBQVdDLEdBQVgsRUFBaUI7QUFDN0IsV0FBT3BDLEtBQUtFLE1BQUwsR0FBY2lDLEtBQWQsRUFBc0JDLEdBQXRCLENBQVA7QUFDRCxHQUZEOztBQUlBcEMsT0FBS2dDLFNBQUwsQ0FBZUcsS0FBZixJQUF3QixVQUFXQyxHQUFYLEVBQWlCO0FBQ3ZDLFdBQU9wQyxLQUFLNkIsT0FBTCxDQUFhM0IsTUFBYixDQUFxQixJQUFyQixFQUE0QmlDLEtBQTVCLEVBQW9DQyxHQUFwQyxDQUFQO0FBQ0QsR0FGRDtBQUdELENBUkQ7O0FBVUEsa0JBQVFOLE9BQVIsQ0FBaUIsa0JBQVU7QUFDekI5QixPQUFLcUMsTUFBTCxJQUFlLFVBQVdELEdBQVgsRUFBaUI7QUFDOUIsV0FBT3BDLEtBQUtFLE1BQUwsR0FBY21DLE1BQWQsRUFBdUJELEdBQXZCLENBQVA7QUFDRCxHQUZEOztBQUlBcEMsT0FBS2dDLFNBQUwsQ0FBZUssTUFBZixJQUF5QixVQUFXRCxHQUFYLEVBQWlCO0FBQ3hDLFFBQU1FLFNBQVMsb0JBQVVyQixLQUFWLENBQWdCLEtBQUtELE9BQXJCLHNCQUNacUIsTUFEWSxFQUNGRCxHQURFLEVBQWY7QUFHQSxXQUFPcEMsS0FBS0UsTUFBTCxDQUFhb0MsTUFBYixDQUFQO0FBQ0QsR0FMRDtBQU1ELENBWEQiLCJmaWxlIjoiRWJheS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZXF1ZXN0ICAgZnJvbSBcIi4vUmVxdWVzdFwiXG5pbXBvcnQge3Rocm93c30gIGZyb20gXCIuL2Vycm9yc1wiXG5pbXBvcnQgSW1tdXRhYmxlIGZyb20gXCIuL3V0aWxzL0ltbXV0YWJsZVwiXG5cbi8vIGR5bmFtaWMgZGVmaW5pdGlvbnMgYWdncmVnYXRlZCBmcm9tIGNyYXdsaW5nIEViYXlcInMgQVBJIGRvY3NcbmltcG9ydCBFbmRwb2ludHMgZnJvbSBcIi4vZGVmaW5pdGlvbnMvZW5kcG9pbnRzXCJcbmltcG9ydCBGaWVsZHMgICAgZnJvbSBcIi4vZGVmaW5pdGlvbnMvZmllbGRzXCJcbmltcG9ydCBHbG9iYWxzICAgZnJvbSBcIi4vZGVmaW5pdGlvbnMvZ2xvYmFsc1wiXG5pbXBvcnQgVmVyYnMgICAgIGZyb20gXCIuL2RlZmluaXRpb25zL3ZlcmJzXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWJheSB7XG4gIC8qKlxuICAgKiBwdXJlIGNyZWF0aW9uIGludGVyZmFjZSB1c2VmdWwgZm9yIGl0ZXJhdGlvbnMgYW5kIG90aGVyIHBsYWNlcyB3aGVyZSBjb250ZXh0IG1heSBiZSBsb3N0XG4gICAqXG4gICAqIEByZXR1cm4gICAgIHt0aGlzfSAgYSBuZXcgRWJheSBpbnN0YW5jZVxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZSAoIHNldHRpbmdzICkge1xuICAgIHJldHVybiBuZXcgRWJheSggc2V0dGluZ3MgKVxuICB9XG5cbiAgLyoqXG4gICAqIExvYWRzIGNyZWRlbnRpYWxzIGZyb20gYHByb2Nlc3MuZW52YFxuICAgKiBcbiAgICogQHJldHVybiB7dGhpc30gICAgICAgICAgYSBuZXcgRWJheSBpbnN0YW5jZVxuICAgKiBAdGhyb3dzIHtFbnZfRXJyb3J9XG4gICAqL1xuICBzdGF0aWMgZnJvbUVudiAoKSB7XG4gICAgcmV0dXJuIEViYXkuY3JlYXRlKHtcbiAgICAgICAgYXV0aFRva2VuIDogcHJvY2Vzcy5lbnYuRUJBWV9UT0tFTiAgIHx8IHRocm93cy5FbnZfRXJyb3IoXCJFQkFZX1RPS0VOXCIpXG4gICAgICAsIGNlcnQgICAgICA6IHByb2Nlc3MuZW52LkVCQVlfQ0VSVCAgICB8fCB0aHJvd3MuRW52X0Vycm9yKFwiRUJBWV9DRVJUXCIpXG4gICAgICAsIGFwcCAgICAgICA6IHByb2Nlc3MuZW52LkVCQVlfQVBQX0lEICB8fCB0aHJvd3MuRW52X0Vycm9yKFwiRUJBWV9BUFBfSURcIilcbiAgICAgICwgZGV2TmFtZSAgIDogcHJvY2Vzcy5lbnYuRUJBWV9ERVZfSUQgIHx8IHRocm93cy5FbnZfRXJyb3IoXCJFQkFZX0RFVl9JRFwiKVxuICAgICAgLCBzYW5kYm94ICAgOiBwcm9jZXNzLmVudi5FQkFZX1NBTkRCT1ggfHwgZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFxuICAgKlxuICAgKiBAcGFyYW0gICAgICB7T2JqZWN0fSAgc2V0dGluZ3MgdGhlIGdsb2JhbCBzZXR0aW5nc1xuICAgKiBAcmV0dXJuICAgICB7RWJheX1cbiAgICovXG4gIGNvbnN0cnVjdG9yICggc2V0dGluZ3MgKSB7XG4gICAgLyoqXG4gICAgICogZ2xvYmFsIHNldHRpbmdzIGZvciBhbGwgZm9sbG93aW5nIEViYXkgcmVxdWVzdHNcbiAgICAgKi9cbiAgICB0aGlzLmdsb2JhbHMgID0gSW1tdXRhYmxlLm1lcmdlKEViYXkuZGVmYXVsdHMsIHNldHRpbmdzKVxuICAgIC8qKlxuICAgICAqIGluc3VyZSBhbiBlcnJvciBpcyB0aHJvd24gaWYgaW50ZXJuYWxzIGFyZSBjaGFuZ2VkXG4gICAgICogYWxsb3dzIGZvciBiZXR0ZXIgYXNzZXJ0aW9ucyBhYm91dCB0aGUgc3RhdGVmdWxuZXNzIFxuICAgICAqL1xuICAgIE9iamVjdC5mcmVlemUodGhpcy5nbG9iYWxzKVxuICB9XG5cbiAgLyoqXG4gICAqIERlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgYEViYXkucHJvdG90eXBlLnJ1bmBcbiAgICogYWRkcyB0byBkZXZlbG9wZXIgZXJnb25vbWljcyBieSBhZGRpbmcgYSBzZW5zaWJsZSBlcnJvclxuICAgKiBcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogQHRocm93cyAgICAge0Vycm9yfVxuICAgKiBAcmV0dXJuICAgICAgbnVsbFxuICAgKi9cbiAgaW52b2tlICgpIHtcbiAgICAgY29uc29sZS53YXJuKFwiZGVwcmVjYXRpb24gd2FybmluZyA6OiB0aGUgLmludm9rZSgpIG1ldGhvZCBoYXMgYmVlbiBtaWdyYXRlZCB0byAucnVuKCkgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmV4dCBtYWpvciByZWxlYXNlXCIpXG4gICAgcmV0dXJuIHRoaXMucnVuKClcbiAgfVxuXG4gIC8qKlxuICAgKiBkZXZlbG9wZXIgZXJnb25vbWljIGVycm9yIHRoYXQgZW5zdXJlcyB3ZSBoYXZlIGF0IGxlYXN0IGRlZmluZWQgdGhlIHZlcmIgd2Ugd2FudCB0byBhdHRlbXB0XG4gICAqIFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gXG4gICAqIEByZXR1cm4gbnVsbFxuICAgKi9cbiAgcnVuICgpIHtcbiAgICB0aHJvd3MuRXJyb3IoXCJDYW5ub3QgcnVuIGFuIGVtcHR5IFJlcXVlc3QsIHBsZWFzZSBkZWZpbmUgYW4gZUJheSB2ZXJiIG9yIGZpZWxkXCIpXG4gIH1cbn1cblxuLyoqXG4gKiBkZWZhdWx0cyBmb3IgZUJheSBBUElcbiAqL1xuRWJheS5kZWZhdWx0cyA9IHtcbiAgICBzZXJ2aWNlTmFtZSAgOiBcIlRyYWRpbmdcIlxuICAsIHNhbmRib3ggICAgICA6IGZhbHNlXG4gICwgc2l0ZSAgICAgICAgIDogMFxuICAsIHJhdyAgICAgICAgICA6IGZhbHNlICAgICAgLy8gcmV0dXJuIHJhdyBYTUwgLT4gSlNPTiByZXNwb25zZSBmcm9tIEViYXlcbiAgLCBwZXJQYWdlICAgICAgOiAxMDBcbn1cblxuLyoqXG4gKiByZWZlcmVuY2UgdG8gdGhlIHtSZXF1ZXN0fSBjbGFzc1xuICovXG5FYmF5LlJlcXVlc3QgPSBSZXF1ZXN0XG5cblZlcmJzLmZvckVhY2goIHZlcmIgPT4ge1xuICBFYmF5W3ZlcmJdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBFYmF5LmNyZWF0ZSgpW3ZlcmJdKClcbiAgfVxuXG4gIEViYXkucHJvdG90eXBlW3ZlcmJdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBFYmF5LlJlcXVlc3QuY3JlYXRlKCB0aGlzIClbdmVyYl0oKVxuICB9XG59KVxuXG5PYmplY3Qua2V5cyhFbmRwb2ludHMpLmZvckVhY2goIGVuZHBvaW50ID0+IHtcbiAgRWJheVtlbmRwb2ludF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIEViYXkuY3JlYXRlKClbZW5kcG9pbnRdKClcbiAgfVxuXG4gIEViYXkucHJvdG90eXBlW2VuZHBvaW50XSA9IGZ1bmN0aW9uICgpIHtcbiAgIHJldHVybiBFYmF5LnNlcnZpY2VOYW1lKCBlbmRwb2ludCApXG4gIH1cblxufSlcblxuRmllbGRzLmZvckVhY2goIGZpZWxkID0+IHtcbiAgRWJheVtmaWVsZF0gPSBmdW5jdGlvbiAoIHZhbCApIHtcbiAgICByZXR1cm4gRWJheS5jcmVhdGUoKVtmaWVsZF0oIHZhbCApXG4gIH1cblxuICBFYmF5LnByb3RvdHlwZVtmaWVsZF0gPSBmdW5jdGlvbiAoIHZhbCApIHtcbiAgICByZXR1cm4gRWJheS5SZXF1ZXN0LmNyZWF0ZSggdGhpcyApW2ZpZWxkXSggdmFsIClcbiAgfVxufSlcblxuR2xvYmFscy5mb3JFYWNoKCBnbG9iYWwgPT4ge1xuICBFYmF5W2dsb2JhbF0gPSBmdW5jdGlvbiAoIHZhbCApIHtcbiAgICByZXR1cm4gRWJheS5jcmVhdGUoKVtnbG9iYWxdKCB2YWwgKVxuICB9XG5cbiAgRWJheS5wcm90b3R5cGVbZ2xvYmFsXSA9IGZ1bmN0aW9uICggdmFsICkge1xuICAgIGNvbnN0IGNsb25lZCA9IEltbXV0YWJsZS5tZXJnZSh0aGlzLmdsb2JhbHMsIHtcbiAgICAgIFtnbG9iYWxdIDogdmFsXG4gICAgfSlcbiAgICByZXR1cm4gRWJheS5jcmVhdGUoIGNsb25lZCApXG4gIH1cbn0pXG5cbiJdfQ==